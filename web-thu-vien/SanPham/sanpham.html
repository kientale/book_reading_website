<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Th∆∞ vi·ªán Online</title>

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/JS/main.js" defer></script>
    <link rel="stylesheet" href="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/SanPham/sanpham.css">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            loadBooks();
        });

        let currentPage = 1;
        let totalPages = 1;
        let currentChuDeId = null; // Ch·ªß ƒë·ªÅ ƒëang ch·ªçn
        let currentPageChuDe = 1;
        let totalPagesChuDe = 1;

        let sortByAllBooks = ""; // Tr·∫°ng th√°i s·∫Øp x·∫øp c·ªßa t·∫•t c·∫£ s√°ch
        let sortByChuDe = "";    // Tr·∫°ng th√°i s·∫Øp x·∫øp theo ch·ªß ƒë·ªÅ

        function loadBooks(sortBy = sortByAllBooks, page = currentPage) {
            currentChuDeId = null;
            sortByAllBooks = sortBy;
            currentPage = page;

            let bookList = document.getElementById("book-list");
            let pagination = document.getElementById("pagination");

            // 1Ô∏è‚É£ Gi·ªØ nguy√™n chi·ªÅu cao danh s√°ch ƒë·ªÉ tr√°nh gi·∫≠t m√†n h√¨nh
            let oldHeight = bookList.offsetHeight;
            bookList.style.minHeight = oldHeight + "px";

            // 2Ô∏è‚É£ ·∫®n d·∫ßn n·ªôi dung c≈© tr∆∞·ªõc khi t·∫£i d·ªØ li·ªáu m·ªõi
            bookList.classList.add("fade-out");

            // 3Ô∏è‚É£ Hi·ªÉn th·ªã Skeleton Loading m√† kh√¥ng l√†m bi·∫øn m·∫•t ph√¢n trang
            setTimeout(() => {
                bookList.innerHTML = `
            <div class="loading-skeleton">
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
            </div>
        `;

                pagination.style.opacity = "0.5"; // Gi·ªØ ph√¢n trang nh∆∞ng gi·∫£m m·ªù
            }, 100);

            fetch(`hienthisach.php?sort=${sortBy}&page=${page}`)
                .then(response => response.json())
                .then(data => {
                    setTimeout(() => {
                        bookList.innerHTML = ""; // X√≥a n·ªôi dung c≈©

                        if (!data.books || data.books.length === 0) {
                            bookList.innerHTML = `<p class="text-center">Kh√¥ng c√≥ s√°ch n√†o.</p>`;
                        } else {
                            data.books.forEach(book => {
                                bookList.innerHTML += `
                            <div class="col-md-4 col-lg-3 mb-4 fade-in">
                                <div class="card book-card shadow-sm" 
                                    onclick="showBookModal(${book.id_sach},'${book.ten_sach}', '${book.tac_gia}', '${book.nam_xuat_ban}', '${book.so_luong}', '${book.so_luot_xem}', '${book.hinh_anh}', '${book.ten_chu_de}')">
                                    <img src="${book.hinh_anh}" class="card-img-top" alt="${book.ten_sach}">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">${book.ten_sach}</h5>
                                    </div>
                                </div>
                            </div>
                        `;
                            });
                        }

                        totalPages = data.totalPages || 1;
                        updatePagination();

                        // 4Ô∏è‚É£ Hi·ªáu ·ª©ng xu·∫•t hi·ªán m∆∞·ª£t m√†
                        bookList.classList.remove("fade-out");

                        // Gi·ªØ chi·ªÅu cao ·ªïn ƒë·ªãnh
                        setTimeout(() => {
                            bookList.style.minHeight = bookList.scrollHeight + "px";
                            pagination.style.opacity = "1"; // Hi·ªán ph√¢n trang d·∫ßn d·∫ßn thay v√¨ ƒë·ªôt ng·ªôt
                        }, 200);
                    }, 200);
                })
                .catch(error => console.error("L·ªói t·∫£i d·ªØ li·ªáu:", error));
        }


        function sortBooksBy(sortBy) {
            if (currentChuDeId) {
                // N·∫øu ƒëang xem s√°ch theo ch·ªß ƒë·ªÅ, c·∫≠p nh·∫≠t sortByChuDe
                sortByChuDe = sortBy;
                loadBooksChuDe(currentChuDeId, currentPageChuDe, sortByChuDe);
            } else {
                // N·∫øu ƒëang xem t·∫•t c·∫£ s√°ch, c·∫≠p nh·∫≠t sortByAllBooks
                sortByAllBooks = sortBy;
                loadBooks(sortByAllBooks, 1);
            }
        }

        // C·∫≠p nh·∫≠t giao di·ªán ph√¢n trang
        function updatePagination() {
            let pagination = document.getElementById("pagination");
            if (!pagination) return;

            pagination.innerHTML = `
    <button class="btn btn-primary" onclick="prevPage()" ${currentPage === 1 ? "disabled" : ""}>Trang tr∆∞·ªõc</button>
    <span class="mx-2">Trang ${currentPage} / ${totalPages}</span>
    <button class="btn btn-primary" onclick="nextPage()" ${currentPage === totalPages ? "disabled" : ""}>Trang sau</button>
`;
        }

        // Chuy·ªÉn trang
        function prevPage() {
            if (currentPage > 1) {
                loadBooks(sortByAllBooks, currentPage - 1);
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                loadBooks(sortByAllBooks, currentPage + 1);
            }
        }


        function showBookModal(id, ten, tacGia, namXB, soLuong, luotXem, hinhAnh, chuDe) {
            let modal = document.getElementById("bookModal");

            if (!modal) {
                console.error("L·ªói: Kh√¥ng t√¨m th·∫•y modal #bookModal");
                return;
            }

            // L∆∞u ID s√°ch v√†o modal
            modal.setAttribute("data-id", id);

            document.getElementById("bookModalLabel").innerText = ten;
            document.getElementById("modalAuthor").innerText = tacGia;
            document.getElementById("modalYear").innerText = namXB;
            document.getElementById("modalQuantity").innerText = soLuong;
            document.getElementById("modalViews").innerText = luotXem ? luotXem : 0;
            document.getElementById("modalImage").src = hinhAnh;
            document.getElementById("modalCategory").innerText = chuDe;

            let myModal = new bootstrap.Modal(modal);
            myModal.show();
        }

        function resetBooks() {
            currentChuDeId = null; // Reset ch·ªß ƒë·ªÅ
            loadBooks();
        }




        //Hi·ªÉn th·ªã ch·ªß ƒë·ªÅ
        document.addEventListener("DOMContentLoaded", function () {
            loadChuDe();
        });

        function loadChuDe() {
            fetch("get_chu_de.php") // API l·∫•y d·ªØ li·ªáu ch·ªß ƒë·ªÅ t·ª´ CSDL
                .then(response => response.json())
                .then(data => {
                    let danhSachChuDe = document.getElementById("danh-sach-chu-de");
                    danhSachChuDe.innerHTML = "";

                    data.forEach(chuDe => {
                        let button = document.createElement("button");
                        button.className = "chu-de-button";
                        button.innerText = chuDe.ten_chu_de;
                        button.onclick = function () {
                            filterByChuDe(chuDe.id_chu_de);
                        };
                        danhSachChuDe.appendChild(button);
                    });
                })
                .catch(error => console.error("L·ªói t·∫£i d·ªØ li·ªáu ch·ªß ƒë·ªÅ:", error));
        }




        function filterByChuDe(idChuDe) {
            currentChuDeId = idChuDe; // L∆∞u l·∫°i ch·ªß ƒë·ªÅ ƒëang ch·ªçn
            currentPage = 1; // Reset v·ªÅ trang ƒë·∫ßu ti√™n

            fetchBooksByChuDe(currentChuDeId, currentPage);
        }


        function fetchBooksByChuDe(chuDe, page, sortBy = '') {
            let url = `hienthisachtheochude.php?chu_de=${chuDe}&page=${page}`;
            if (sortBy) url += `&sort_by=${sortBy}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    let bookList = document.getElementById("book-list");
                    let pagination = document.getElementById("pagination");
                    let categoryTitle = document.getElementById("category-title");
                    bookList.innerHTML = "";

                    if (!data.books || data.books.length === 0) {
                        bookList.innerHTML = `<p class="text-center">Kh√¥ng c√≥ s√°ch n√†o trong ch·ªß ƒë·ªÅ n√†y.</p>`;
                        pagination.style.display = "none";
                        return;
                    }

                    pagination.style.display = "block";
                    let tenChuDe = data.ten_chu_de || "Ch·ªß ƒë·ªÅ kh√¥ng x√°c ƒë·ªãnh";
                    categoryTitle.innerText = `Ch·ªß ƒë·ªÅ: ${tenChuDe}`;

                    data.books.forEach(book => {
                        bookList.innerHTML += `
            <div class="col-md-4 col-lg-3 mb-4">
                <div class="card book-card shadow-sm" 
                    onclick="showBookModal(${book.id_sach},'${book.ten_sach}', '${book.tac_gia}', '${book.nam_xuat_ban}', '${book.so_luong}', '${book.so_luot_xem}', '${book.hinh_anh}', '${tenChuDe}')">
                    <img src="${book.hinh_anh}" class="card-img-top" alt="${book.ten_sach}" onerror="this.onerror=null; this.src='img/default.png';">
                    <div class="card-body text-center">
                        <h5 class="card-title">${book.ten_sach}</h5>
                    </div>
                </div>
            </div>
        `;
                    });

                    updatePagination(data.totalPages);
                })
                .catch(error => console.error("L·ªói t·∫£i d·ªØ li·ªáu s√°ch theo ch·ªß ƒë·ªÅ:", error));
        }


        function loadBooksChuDe(chuDeId, page = 1, sortBy = sortByChuDe) {
            currentChuDeId = chuDeId;
            sortByChuDe = sortBy;
            currentPageChuDe = page;

            let bookList = document.getElementById("book-list");
            let pagination = document.getElementById("pagination");

            // 1Ô∏è‚É£ Gi·ªØ nguy√™n chi·ªÅu cao ƒë·ªÉ tr√°nh layout b·ªã gi·∫≠t
            let oldHeight = bookList.offsetHeight;
            bookList.style.minHeight = oldHeight + "px";

            // 2Ô∏è‚É£ ·∫®n d·∫ßn n·ªôi dung c≈© tr∆∞·ªõc khi t·∫£i d·ªØ li·ªáu m·ªõi
            bookList.classList.add("fade-out");

            // 3Ô∏è‚É£ Hi·ªÉn th·ªã Skeleton Loading
            setTimeout(() => {
                bookList.innerHTML = `
        <div class="loading-skeleton">
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
        </div>`;

                pagination.style.opacity = "0.5"; // Gi·ªØ ph√¢n trang nh∆∞ng gi·∫£m m·ªù
            }, 150);

            fetch(`hienthisachtheochude.php?chu_de=${chuDeId}&page=${page}&sort_by=${sortBy}`)
                .then(response => response.json())
                .then(data => {
                    setTimeout(() => {
                        bookList.innerHTML = ""; // X√≥a n·ªôi dung c≈© khi c√≥ d·ªØ li·ªáu m·ªõi

                        if (!data.books || data.books.length === 0) {
                            bookList.innerHTML = `<p class="text-center">Kh√¥ng c√≥ s√°ch n√†o trong ch·ªß ƒë·ªÅ n√†y.</p>`;
                        } else {
                            let tenChuDe = data.ten_chu_de || "Ch·ªß ƒë·ªÅ kh√¥ng x√°c ƒë·ªãnh";
                            data.books.forEach(book => {
                                bookList.innerHTML += `
                        <div class="col-md-4 col-lg-3 mb-4 fade-in">
                            <div class="card book-card shadow-sm" 
                                onclick="showBookModal(${book.id_sach},'${book.ten_sach}', '${book.tac_gia}', '${book.nam_xuat_ban}', '${book.so_luong}', '${book.so_luot_xem}', '${book.hinh_anh}', '${tenChuDe}')">
                                <img src="${book.hinh_anh}" class="card-img-top" alt="${book.ten_sach}" onerror="this.onerror=null; this.src='img/default.png';">
                                <div class="card-body text-center">
                                    <h5 class="card-title">${book.ten_sach}</h5>
                                </div>
                            </div>
                        </div>`;
                            });

                            totalPagesChuDe = data.totalPages;
                            updatePaginationChuDe();
                        }

                        // 4Ô∏è‚É£ Hi·ªáu ·ª©ng xu·∫•t hi·ªán m∆∞·ª£t m√†
                        bookList.classList.remove("fade-out");

                        // Gi·ªØ chi·ªÅu cao ·ªïn ƒë·ªãnh
                        setTimeout(() => {
                            bookList.style.minHeight = bookList.scrollHeight + "px";
                            pagination.style.opacity = "1"; // Hi·ªán ph√¢n trang d·∫ßn d·∫ßn thay v√¨ ƒë·ªôt ng·ªôt
                        }, 200);
                    }, 200); // Gi·ªØ Skeleton Loading t·ªëi thi·ªÉu 300ms ƒë·ªÉ tr√°nh qu√° nhanh
                })
                .catch(error => console.error("L·ªói t·∫£i d·ªØ li·ªáu s√°ch theo ch·ªß ƒë·ªÅ:", error));
        }


        function updatePaginationChuDe() {
            let pagination = document.getElementById("pagination");
            if (!pagination) return;

            pagination.innerHTML = `
    <button class="btn btn-primary" onclick="prevPageChuDe()" ${currentPageChuDe === 1 ? "disabled" : ""}>Trang tr∆∞·ªõc</button>
    <span class="mx-2">Trang ${currentPageChuDe} / ${totalPagesChuDe}</span>
    <button class="btn btn-primary" onclick="nextPageChuDe()" ${currentPageChuDe === totalPagesChuDe ? "disabled" : ""}>Trang sau</button>
`;
        }

        function prevPageChuDe() {
            if (currentPageChuDe > 1) {
                loadBooksChuDe(currentChuDeId, currentPageChuDe - 1, sortByChuDe);
            }
        }

        function nextPageChuDe() {
            if (currentPageChuDe < totalPagesChuDe) {
                loadBooksChuDe(currentChuDeId, currentPageChuDe + 1, sortByChuDe);
            }
        }


        // Khi ch·ªçn ch·ªß ƒë·ªÅ, g·ªçi h√†m m·ªõi
        function filterByChuDe(chuDeId) {
            currentChuDeId = chuDeId;
            currentPage = 1;
            loadBooksChuDe(currentChuDeId, currentPage);
        }

    </script>
</head>

<body class="loading">
    <!-- Loading Animation -->
    <div id="loading"></div>
    <!-- Header -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <!-- N√∫t toggle khi thu nh·ªè -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Danh s√°ch menu -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 menu">
                        <li class="nav-item">
                            <a class="nav-link active"
                                href="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/trangchu/trangchu.html">Trang
                                ch·ªß</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link"
                                href="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/GioiThieu/gioithieu.html">Gi·ªõi
                                thi·ªáu</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link"
                                href="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/SanPham/sanpham.html">S·∫£n
                                ph·∫©m</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link"
                                href="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/Tintuc/tintuc.html">Tin
                                t·ª©c</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link"
                                href="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/Lienhe/lienhe.html">Li√™n
                                h·ªá</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link"
                                href="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/DangNhap_DangKy/DangNhap/dangnhap.html">ƒêƒÉng
                                nh·∫≠p</a>
                        </li>
                    </ul>

                    <!-- Form t√¨m ki·∫øm -->
                    <form class="d-flex search-form">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-success" type="submit">Search</button>
                    </form>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <!-- Banner -->
        <section id="banner" class="d-flex align-items-center justify-content-center text-center">
            <div class="text-content">
                <h3>KTL - LIBRARY</h3>
                <h1>CLASS OF 2025</h1>
                <hr class="line">
            </div>
        </section>

        <!-- N·ªôi dung ch√≠nh -->
        <div class="main-container">
            <div class="noi-dung">
                <div class="content-container">
                    <!-- Kh·ªëi b√™n tr√°i -->
                    <div class="container" style="margin: 10px 60px 20px 60px;">
                        <div class="chu-de-container">
                            <h2 class="text-center text-light">Danh s√°ch Ch·ªß ƒë·ªÅ</h2>
                            <div class="chu-de-buttons d-flex flex-wrap justify-content-center" id="danh-sach-chu-de">
                                <!-- Ch·ªß ƒë·ªÅ s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                            </div>
                        </div>

                        <!-- Kh·ªëi b√™n ph·∫£i -->
                        <div class="sach-container">
                            <!-- Thanh l·ªçc v·ªõi n·ªÅn m√†u -->
                            <div class="d-flex align-items-center mb-2">
                                <div class="sort-container p-3 rounded d-flex justify-content-center border flex-grow-1"
                                    style="background-color:#21130d; margin-right: 10px; color: white; font-size: 20px;">
                                    <label class="me-2 fw-bold">S·∫Øp x·∫øp</label>
                                    <button class="btn btn-primary me-2" onclick="sortBooksBy('views')">L∆∞·ª£t
                                        xem</button>
                                    <button class="btn btn-success me-2" onclick="sortBooksBy('year')">NƒÉm xu·∫•t
                                        b·∫£n</button>
                                    <button class="btn btn-warning me-2" onclick="sortBooksBy('quantity')">S·ªë
                                        l∆∞·ª£ng</button>
                                    <button class="btn btn-secondary" onclick="loadBooks()">Reset</button>
                                </div>
                            </div>

                            <!-- Danh s√°ch s√°ch d·∫°ng card -->
                            <div class="row" id="book-list"></div>

                            <!-- Ph√¢n trang -->
                            <div id="pagination" class="text-center mt-3"></div>
                        </div>
                    </div>
                </div>
                <div class="pink-section text-center p-4">
                    <div class="container-fluid text-center">
                        <div class="numbers d-flex flex-md-row flex-wrap justify-content-center">
                            <div class="rect">
                                <h1>120</h1>
                                <p>Ng∆∞·ªùi ƒë·ªçc</p>
                            </div>
                            <div class="rect">
                                <h1>40</h1>
                                <p>ƒê√°nh gi√° t·ª´ ng∆∞·ªùi ƒë·ªçc</p>
                            </div>
                            <div class="rect">
                                <h1>6</h1>
                                <p>Ng∆∞·ªùi ƒë·ªçc tr·ª±c tuy·∫øn</p>
                            </div>
                            <div class="rect">
                                <h1>152</h1>
                                <p>Cu·ªën s√°ch</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-section">
                <!-- Hi·ªÉn th·ªã danh ng√¥n -->
                <div class="danh-ngon bg-dark text-light p-3 rounded text-center">
                    <blockquote id="danhNgonText" class="fs-5 fst-italic"></blockquote>
                </div>



                <!-- Hi·ªÉn th·ªã s√°ch g·ª£i √Ω-->
                <h2 class="text-center text-light" style="margin-top: 20px;">S√°ch G·ª£i √ù</h2>

                <!-- Carousel Bootstrap -->
                <div id="sachCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner" id="sach-goi-y"></div>

                    <!-- N√∫t ƒëi·ªÅu h∆∞·ªõng tr√°i/ph·∫£i -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#sachCarousel"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#sachCarousel"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    </button>
                </div>

                <!-- H√¨nh ·∫£nh b·ªï sung -->
                <div class="extra-images mt-3 text-center">
                    <img src="https://i.pinimg.com/736x/a9/5f/e6/a95fe66ec983b16b38af8439751e702c.jpg"
                        class="img-fluid rounded shadow mt-2" alt="H√¨nh 2" width="100%">
                </div>

            </div>

            <script>
                /* Hi·ªÉn th·ªã s√°ch g·ª£i √Ω*/
                document.addEventListener("DOMContentLoaded", function () {
                    fetch("hienthisachgoiy.php")
                        .then(response => response.json())
                        .then(data => {
                            const container = document.getElementById("sach-goi-y");
                            container.innerHTML = "";

                            // L∆∞u d·ªØ li·ªáu s√°ch v√†o bi·∫øn to√†n c·ª•c (l∆∞u theo id_sach)
                            window.bookData = {};
                            data.forEach(sach => {
                                window.bookData[sach.id_sach] = sach;
                            });

                            data.forEach((sach, index) => {
                                const activeClass = index === 0 ? "active" : "";

                                const sachElement = `
                    <div class="carousel-item ${activeClass}">
                        <div class="container">
                            <div class="row sach-card align-items-center" 
                                onclick="openBookModal(${sach.id_sach})"
                                style="cursor: pointer;">
                                
                                <!-- H√¨nh ·∫£nh s√°ch b√™n tr√°i -->
                                <div class="col-md-4 text-center">
                                    <img src="${sach.hinh_anh}" class="img-fluid sach-anh rounded shadow border" 
                                        alt="${sach.ten_sach}">
                                </div>

                                <!-- Th√¥ng tin s√°ch b√™n ph·∫£i -->
                                <div class="col-md-8 sach-info bg-white p-3 rounded shadow">
                                    <h4 class="fw-bold">${sach.ten_sach}</h4>
                                    <p><strong>T√°c gi·∫£:</strong> ${sach.tac_gia}</p>
                                    <p><strong>Ch·ªß ƒë·ªÅ:</strong> ${sach.chu_de}</p>
                                    <p>${sach.mo_ta_sach}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                                container.innerHTML += sachElement;
                            });
                        })
                        .catch(error => console.error("L·ªói t·∫£i s√°ch g·ª£i √Ω:", error));
                });



                function openBookModal(id_sach) {
                    if (!window.bookData || !window.bookData[id_sach]) {
                        console.error("Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu s√°ch.");
                        return;
                    }

                    const sach = window.bookData[id_sach];

                    // G√°n ID s√°ch v√†o modal
                    const modal = document.getElementById("bookModal");
                    modal.setAttribute("data-id", id_sach);

                    // Hi·ªÉn th·ªã th√¥ng tin s√°ch trong modal
                    document.getElementById("bookModalLabel").innerText = sach.ten_sach || "Ch∆∞a c√≥ th√¥ng tin";
                    document.getElementById("modalImage").src = sach.hinh_anh || "placeholder.png";
                    document.getElementById("modalAuthor").innerText = sach.tac_gia || "Kh√¥ng x√°c ƒë·ªãnh";
                    document.getElementById("modalYear").innerText = sach.nam_xuat_ban || "Ch∆∞a c√≥ th√¥ng tin";
                    document.getElementById("modalQuantity").innerText = sach.so_luong || "Kh√¥ng x√°c ƒë·ªãnh";
                    document.getElementById("modalViews").innerText = sach.so_luot_xem || "0";
                    document.getElementById("modalCategory").innerText = sach.chu_de || "Kh√¥ng r√µ";

                    // Hi·ªÉn th·ªã modal
                    const myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }


                /* Hi·ªÉn th·ªã danh ng√¥n*/
                document.addEventListener("DOMContentLoaded", function () {
                    // L·∫•y danh ng√¥n ng·∫´u nhi√™n
                    fetch("getdanhngon.php")
                        .then(response => response.json())
                        .then(data => {
                            if (data.danh_ngon) {
                                document.getElementById("danhNgonText").innerText = `"${data.danh_ngon}"`;
                            } else {
                                document.getElementById("danhNgonText").innerText = "Kh√¥ng c√≥ danh ng√¥n n√†o.";
                            }
                        })
                        .catch(error => console.error("L·ªói t·∫£i danh ng√¥n:", error));
                });

            </script>



        </div>

        <script>
            function openBook() {
                let modal = document.getElementById("bookModal");
                let bookId = modal.dataset.id; // L·∫•y ID s√°ch

                if (!bookId || isNaN(bookId)) {
                    alert("‚ùå L·ªói: ID s√°ch kh√¥ng h·ª£p l·ªá!");
                    return;
                }

                console.log("üìñ ƒêang t·∫£i n·ªôi dung s√°ch v·ªõi ID:", bookId);

                // G·ªçi API ƒë·ªÉ l·∫•y n·ªôi dung s√°ch
                fetch(`laynoidungsach.php?id=${bookId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.success) {
                            alert("‚ùå Kh√¥ng th·ªÉ t·∫£i n·ªôi dung s√°ch: " + data.error);
                            return;
                        }

                        // C·∫≠p nh·∫≠t n·ªôi dung PDF v√†o iframe
                        document.getElementById("pdfViewer").src = "data:application/pdf;base64," + data.pdf;

                        // Hi·ªÉn th·ªã modal ƒë·ªçc s√°ch
                        new bootstrap.Modal(document.getElementById("pdfModal")).show();
                    })
                    .catch(error => {
                        console.error("‚ùå L·ªói khi t·∫£i s√°ch:", error);
                        alert("‚ö† L·ªói khi k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß!");
                    });
            }
        </script>

        <!-- Modal Bootstrap -->
        <div class="modal fade" id="bookModal" tabindex="-1" aria-labelledby="bookModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg"> <!-- M·ªü r·ªông modal -->
                <div class="modal-content p-3">
                    <div class="modal-header">
                        <h4 class="modal-title fw-bold" id="bookModalLabel"></h4> <!-- Ti√™u ƒë·ªÅ l·ªõn h∆°n -->
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row align-items-center">
                            <!-- H√¨nh ·∫£nh b√™n tr√°i, chi·∫øm 45% -->
                            <div class="col-md-5 text-center">
                                <img id="modalImage" src="" class="img-fluid rounded shadow border"
                                    style="max-width: 100%; height: auto; max-height: 400px;">
                            </div>

                            <!-- Th√¥ng tin s√°ch b√™n ph·∫£i, chi·∫øm 55% -->
                            <div class="col-md-7">
                                <p class="fs-4"><strong>T√°c gi·∫£:</strong> <span id="modalAuthor"></span></p>
                                <p class="fs-4"><strong>NƒÉm XB:</strong> <span id="modalYear"></span></p>
                                <p class="fs-4"><strong>S·ªë l∆∞·ª£ng:</strong> <span id="modalQuantity"></span></p>
                                <p class="fs-4"><strong>L∆∞·ª£t xem:</strong> <span id="modalViews"></span></p>
                                <p class="fs-4"><strong>Ch·ªß ƒë·ªÅ:</strong> <span id="modalCategory"></span></p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-between">
                        <div>
                            <button type="button" class="btn btn-lg btn-success" onclick="openBook()">üìñ ƒê·ªçc
                                ngay</button>
                            <button type="button" class="btn btn-lg btn-dark">üìÇ L∆∞u s√°ch</button>
                            <!-- ƒê·ªïi m√†u icon sang ƒëen -->
                        </div>
                        <button type="button" class="btn btn-lg btn-secondary" data-bs-dismiss="modal">‚ùå ƒê√≥ng</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal hi·ªÉn th·ªã n·ªôi dung s√°ch -->
        <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content" style="height: 95vh;">
                    <div class="modal-header">
                        <h4 class="modal-title fw-bold" id="pdfModalLabel">üìñ N·ªôi dung s√°ch</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <!-- N·ªôi dung s√°ch -->
                    <div class="modal-body p-0" style="height: calc(100% - 150px); overflow: hidden;">
                        <iframe id="pdfViewer" width="100%" height="100%" style="border: none;"></iframe>
                    </div>

                    <!-- Ph·∫ßn b√¨nh lu·∫≠n -->
                    <div class="p-3 border-top">
                        <h5 class="fw-bold">üì¢ B√¨nh lu·∫≠n</h5>
                        <div id="commentSectionPdf" class="mb-3">
                            <!-- Danh s√°ch b√¨nh lu·∫≠n s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                        </div>

                        <!-- Form nh·∫≠p b√¨nh lu·∫≠n -->
                        <textarea id="commentInputPdf" class="form-control" rows="2"
                            placeholder="Nh·∫≠p b√¨nh lu·∫≠n c·ªßa b·∫°n..."></textarea>
                        <button class="btn btn-primary mt-2" onclick="addCommentPdf()">G·ª≠i b√¨nh lu·∫≠n</button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            function addCommentPdf() {
                var commentInput = document.getElementById("commentInputPdf").value.trim();
                var modal = document.getElementById("pdfModal");
                var bookId = modal.getAttribute("data-book-id");
                var username = modal.getAttribute("data-username");

                console.log("Book ID:", bookId);
                console.log("Username:", username);

                if (!commentInput) {
                    alert("Vui l√≤ng nh·∫≠p n·ªôi dung b√¨nh lu·∫≠n!");
                    return;
                }
                if (!bookId) {
                    alert("Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c ID s√°ch!");
                    return;
                }

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "save_comment.php", true);
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        if (response.success) {
                            var commentSection = document.getElementById("commentSectionPdf");
                            var newComment = document.createElement("p");
                            newComment.innerHTML = "<strong>" + username + ":</strong> " + commentInput;
                            newComment.classList.add("border", "p-2", "rounded", "bg-light");
                            commentSection.appendChild(newComment);

                            document.getElementById("commentInputPdf").value = "";
                        } else {
                            alert("L·ªói khi l∆∞u b√¨nh lu·∫≠n: " + response.error);
                        }
                    }
                };
                xhr.send("id_sach=" + encodeURIComponent(bookId) + "&binh_luan=" + encodeURIComponent(commentInput) + "&username=" + encodeURIComponent(username));
            }
        </script>

        <!-- Icons g√≥c d∆∞·ªõi b√™n ph·∫£i -->
        <div class="floating-icons">
            <a href="#" class="icon-btn chat-btn">
                <img src="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/img/man-2_icon-icons.com_55041.png"
                    alt="C√° nh√¢n">
            </a>
            <a href="#" class="icon-btn balo-btn" data-bs-toggle="modal" data-bs-target="#baloModal">
                <img src="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/img/shoppaymentorderbuy-34_icon-icons.com_73865.png"
                    alt="Balo">
            </a>
            <a href="#" class="icon-btn scroll-top-btn">
                <img src="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/img/arrow_circle_up_icon_155797.png"
                    alt="L√™n ƒë·∫ßu trang">
            </a>
            <a href="#" class="icon-btn scroll-top-btn" data-bs-toggle="modal" data-bs-target="#chatModal">
                <img src="http://localhost/PHP-project/Web%20Th%c6%b0%20vi%e1%bb%87n/img/social_facebook_messenger_icon-icons.com_66150.png"
                    alt="Chat">
            </a>
        </div>

        <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="chatModalLabel">Chat v·ªõi AI</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="chat-output" class="border p-3 mb-3" style="height: 250px; overflow-y: auto;"></div>
                        <div class="input-group">
                            <input type="text" id="chat-input" class="form-control" placeholder="Nh·∫≠p tin nh·∫Øn...">
                            <button id="sendMessage" class="btn btn-success">G·ª≠i</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const chatOutput = document.getElementById("chat-output");
                const chatInput = document.getElementById("chat-input");
                const sendMessage = document.getElementById("sendMessage");

                sendMessage.addEventListener("click", function () {
                    const userMessage = chatInput.value.trim();
                    if (userMessage === "") return;

                    // Hi·ªÉn th·ªã tin nh·∫Øn ng∆∞·ªùi d√πng
                    chatOutput.innerHTML += `<div><strong>B·∫°n:</strong> ${userMessage}</div>`;
                    chatInput.value = "";

                    // G·ª≠i ƒë·∫øn server ƒë·ªÉ x·ª≠ l√Ω AI
                    fetch("chat_ai.php", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ message: userMessage })
                    })
                        .then(response => response.json())
                        .then(data => {
                            chatOutput.innerHTML += `<div><strong>AI:</strong> ${data.reply}</div>`;
                            chatOutput.scrollTop = chatOutput.scrollHeight; // Cu·ªôn xu·ªëng tin nh·∫Øn m·ªõi nh·∫•t
                        })
                        .catch(error => console.error("L·ªói g·ª≠i tin nh·∫Øn:", error));
                });
            });
        </script>

        <!-- Modal Balo -->
        <div class="modal fade" id="baloModal" tabindex="-1" aria-labelledby="baloModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content p-3">
                    <div class="modal-header">
                        <h4 class="modal-title fw-bold" id="baloModalLabel">S√°ch ƒë√£ l∆∞u</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <ul id="savedBooksList" class="list-group">
                            <!-- Danh s√°ch s√°ch s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-lg btn-secondary" data-bs-dismiss="modal"> ƒê√≥ng</button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                loadSavedBooks(); // G·ªçi h√†m t·∫£i s√°ch khi trang t·∫£i xong

                // S·ª± ki·ªán khi b·∫•m n√∫t "Th√™m v√†o balo"
                document.addEventListener("click", function (event) {
                    if (!event.target.classList.contains("btn-dark")) return;

                    let modal = event.target.closest(".modal");
                    if (!modal) return;

                    let title, author, year, imageSrc;
                    if (modal.id === "bookModal") {
                        title = document.getElementById("bookModalLabel").innerText;
                        author = document.getElementById("modalAuthor").innerText;
                        year = document.getElementById("modalYear").innerText;
                        imageSrc = document.getElementById("modalImage").src;
                    } else if (modal.id === "hotBookModal") {
                        title = document.getElementById("hotBookModalLabel").innerText;
                        author = document.getElementById("hotModalAuthor").innerText;
                        year = document.getElementById("hotModalYear").innerText;
                        imageSrc = document.getElementById("hotModalImage").src;
                    } else {
                        return;
                    }

                    const savedBooksList = document.getElementById("savedBooksList");

                    // ‚ùå Ki·ªÉm tra n·∫øu s√°ch ƒë√£ t·ªìn t·∫°i trong danh s√°ch th√¨ kh√¥ng th√™m n·ªØa
                    if ([...savedBooksList.children].some(li => li.dataset.title === title)) {
                        alert("S√°ch ƒë√£ t·ªìn t·∫°i trong balo!");
                        return;
                    }

                    // ‚úÖ Th√™m s√°ch v√†o danh s√°ch hi·ªÉn th·ªã
                    const listItem = document.createElement("li");
                    listItem.classList.add("list-group-item", "d-flex", "align-items-center", "justify-content-between");
                    listItem.dataset.title = title;

                    listItem.innerHTML = `
            <img src="${imageSrc}" class="rounded shadow border" style="width: 50px;">
            <span><strong>${title}</strong> - ${author} (${year})</span>
            <div class="saved-book-buttons">
                <button class="btn btn-sm btn-success">üìñ ƒê·ªçc ngay</button>
                <button class="btn btn-sm btn-danger">‚ùå X√≥a</button>
            </div>
        `;
                    savedBooksList.appendChild(listItem);

                    alert("S√°ch ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o balo!");

                    // üî• G·ª≠i d·ªØ li·ªáu l√™n server ƒë·ªÉ l∆∞u v√†o CSDL
                    fetch("save_book.php", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ title, author, year, image_url: imageSrc }),
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.status === "success") {
                                console.log("S√°ch ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o CSDL!");
                            } else {
                                console.error("L·ªói l∆∞u s√°ch:", data.message);
                            }
                        })
                        .catch(error => console.error("L·ªói g·ª≠i y√™u c·∫ßu:", error));
                });

                // S·ª± ki·ªán x√≥a s√°ch kh·ªèi danh s√°ch
                document.addEventListener("click", function (event) {
                    if (!event.target.classList.contains("btn-danger")) return;

                    let listItem = event.target.closest("li");
                    if (!listItem) return;

                    let title = listItem.dataset.title;

                    if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s√°ch "${title}" kh·ªèi balo?`)) return;

                    // ‚ùå Tr√°nh x√≥a 2 l·∫ßn b·∫±ng c√°ch ki·ªÉm tra s√°ch c√≥ t·ªìn t·∫°i kh√¥ng tr∆∞·ªõc khi g·ªçi API
                    if (!document.body.contains(listItem)) {
                        return;
                    }

                    fetch("xoa_saved_sach.php", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ ten_sach: title })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                listItem.remove(); // ‚úÖ X√≥a kh·ªèi danh s√°ch hi·ªÉn th·ªã
                                alert("S√°ch ƒë√£ ƒë∆∞·ª£c x√≥a kh·ªèi balo!");
                            } else {
                                alert("L·ªói khi x√≥a s√°ch: " + data.message);
                            }
                        })
                        .catch(error => console.error("L·ªói g·ª≠i y√™u c·∫ßu x√≥a:", error));
                });

            });

            // H√†m t·∫£i s√°ch ƒë√£ l∆∞u t·ª´ CSDL
            function loadSavedBooks() {
                fetch("get_saved_books.php")
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === "success") {
                            const books = data.books;
                            const savedBooksList = document.getElementById("savedBooksList");
                            savedBooksList.innerHTML = ""; // X√≥a danh s√°ch c≈©

                            books.forEach(book => {
                                const listItem = document.createElement("li");
                                listItem.classList.add("list-group-item", "d-flex", "align-items-center", "justify-content-between");
                                listItem.dataset.title = book.book_title;

                                listItem.innerHTML = `
                        <img src="${book.image_url}" class="rounded shadow border" style="width: 50px;">
                        <span><strong>${book.book_title}</strong> - ${book.author} (${book.year})</span>
                        <div class="saved-book-buttons">
                            <button class="btn btn-sm btn-success">üìñ ƒê·ªçc ngay</button>
                            <button class="btn btn-sm btn-danger">‚ùå X√≥a</button>
                        </div>
                    `;
                                savedBooksList.appendChild(listItem);
                            });
                        } else {
                            console.error("L·ªói: ", data.message);
                        }
                    })
                    .catch(error => console.error("L·ªói khi t·∫£i s√°ch:", error));
            }
        </script>

        <!-- Popup (Modal) Bootstrap -->
        <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="userModalLabel">Th√¥ng tin ng∆∞·ªùi d√πng</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>H·ªç T√™n:</strong> <span id="popup-ho-ten"></span></p>
                        <p><strong>Email:</strong> <span id="popup-email"></span></p>
                        <p><strong>T√†i kho·∫£n:</strong> <span id="popup-username"></span></p>
                        <p><strong>Tu·ªïi:</strong> <span id="popup-tuoi"></span></p>
                        <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span id="popup-so-dien-thoai"></span></p>
                        <p><strong>ƒê·ªãa ch·ªâ:</strong> <span id="popup-dia-chi"></span></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" id="logoutBtn">
                            ƒêƒÉng xu·∫•t
                        </button>
                        <button type="button" class="btn btn-primary" id="editInfoBtn">
                            S·ª≠a th√¥ng tin
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal S·ª≠a Th√¥ng Tin -->
        <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editUserModalLabel">S·ª≠a Th√¥ng Tin</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="editUserForm">
                            <div class="mb-3">
                                <label for="editHoTen" class="form-label">H·ªç T√™n</label>
                                <input type="text" class="form-control" id="editHoTen" required>
                            </div>
                            <div class="mb-3">
                                <label for="editTaiKhoan" class="form-label">T√†i Kho·∫£n</label>
                                <input type="text" class="form-control" id="editTaiKhoan" required>
                            </div>
                            <div class="mb-3">
                                <label for="editMatKhau" class="form-label">M·∫≠t Kh·∫©u</label>
                                <input type="password" class="form-control" id="editMatKhau" required>
                            </div>
                            <div class="mb-3">
                                <label for="editTuoi" class="form-label">Tu·ªïi</label>
                                <input type="number" class="form-control" id="editTuoi" required>
                            </div>
                            <div class="mb-3">
                                <label for="editEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="editEmail" required>
                            </div>
                            <div class="mb-3">
                                <label for="editSoDienThoai" class="form-label">S·ªë ƒêi·ªán Tho·∫°i</label>
                                <input type="text" class="form-control" id="editSoDienThoai" required>
                            </div>
                            <div class="mb-3">
                                <label for="editDiaChi" class="form-label">ƒê·ªãa Ch·ªâ</label>
                                <input type="text" class="form-control" id="editDiaChi" required>
                            </div>
                            <button type="submit" class="btn btn-primary">L∆∞u Thay ƒê·ªïi</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <script>
            document.addEventListener("DOMContentLoaded", function () {
                let editBtn = document.getElementById("editInfoBtn");

                if (!editBtn) {
                    console.error("Kh√¥ng t√¨m th·∫•y n√∫t #editInfoBtn.");
                    return;
                }

                editBtn.addEventListener("click", function () {
                    let hoTenElem = document.getElementById("popup-ho-ten");
                    let emailElem = document.getElementById("popup-email");
                    let usernameElem = document.getElementById("popup-username");
                    let tuoiElem = document.getElementById("popup-tuoi");
                    let soDienThoaiElem = document.getElementById("popup-so-dien-thoai");
                    let diaChiElem = document.getElementById("popup-dia-chi");

                    if (!hoTenElem || !emailElem || !usernameElem || !tuoiElem || !soDienThoaiElem || !diaChiElem) {
                        console.error("Kh√¥ng t√¨m th·∫•y m·ªôt trong c√°c ph·∫ßn t·ª≠ th√¥ng tin ng∆∞·ªùi d√πng.");
                        return;
                    }

                    let editHoTen = document.getElementById("editHoTen");
                    let editTaiKhoan = document.getElementById("editTaiKhoan");
                    let editMatKhau = document.getElementById("editMatKhau");
                    let editTuoi = document.getElementById("editTuoi");
                    let editEmail = document.getElementById("editEmail");
                    let editSoDienThoai = document.getElementById("editSoDienThoai");
                    let editDiaChi = document.getElementById("editDiaChi");

                    if (!editHoTen || !editTaiKhoan || !editMatKhau || !editTuoi || !editEmail || !editSoDienThoai || !editDiaChi) {
                        console.error("Kh√¥ng t√¨m th·∫•y m·ªôt trong c√°c ph·∫ßn t·ª≠ form ch·ªânh s·ª≠a.");
                        return;
                    }

                    editHoTen.value = hoTenElem.textContent.trim();
                    editTaiKhoan.value = usernameElem.textContent.trim();
                    editMatKhau.value = "";
                    editTuoi.value = tuoiElem.textContent.trim();
                    editEmail.value = emailElem.textContent.trim();
                    editSoDienThoai.value = soDienThoaiElem.textContent.trim();
                    editDiaChi.value = diaChiElem.textContent.trim();

                    let editModalElem = document.getElementById("editUserModal");
                    if (!editModalElem) {
                        console.error("Kh√¥ng t√¨m th·∫•y modal #editUserModal.");
                        return;
                    }

                    let editModal = new bootstrap.Modal(editModalElem);
                    editModal.show();
                });

                let editUserForm = document.getElementById("editUserForm");
                if (!editUserForm) {
                    console.error("Kh√¥ng t√¨m th·∫•y form #editUserForm.");
                    return;
                }

                editUserForm.addEventListener("submit", function (event) {
                    event.preventDefault();

                    let updatedUserInfo = {
                        taiKhoan: document.getElementById("editTaiKhoan").value.trim(),
                        matKhau: document.getElementById("editMatKhau").value.trim(),
                        hoTen: document.getElementById("editHoTen").value.trim(),
                        tuoi: document.getElementById("editTuoi").value.trim(),
                        email: document.getElementById("editEmail").value.trim(),
                        soDienThoai: document.getElementById("editSoDienThoai").value.trim(),
                        diaChi: document.getElementById("editDiaChi").value.trim(),
                    };

                    console.log("D·ªØ li·ªáu g·ª≠i ƒëi:", updatedUserInfo);

                    fetch("suathongtin.php", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(updatedUserInfo),
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log("Ph·∫£n h·ªìi t·ª´ server:", data);
                            if (data.success) {
                                alert("C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!");
                                // C·∫≠p nh·∫≠t n·ªôi dung modal ngay l·∫≠p t·ª©c
                                document.getElementById("popup-ho-ten").innerText = updatedUserInfo.hoTen;
                                document.getElementById("popup-email").innerText = updatedUserInfo.email;
                                document.getElementById("popup-username").innerText = updatedUserInfo.taiKhoan;
                                document.getElementById("popup-tuoi").innerText = updatedUserInfo.tuoi;
                                document.getElementById("popup-so-dien-thoai").innerText = updatedUserInfo.soDienThoai;
                                document.getElementById("popup-dia-chi").innerText = updatedUserInfo.diaChi;

                                // C·∫≠p nh·∫≠t cookie ƒë·ªÉ gi·ªØ th√¥ng tin m·ªõi
                                document.cookie = `hoTen=${encodeURIComponent(updatedUserInfo.hoTen)}; path=/`;
                                document.cookie = `email=${encodeURIComponent(updatedUserInfo.email)}; path=/`;
                                document.cookie = `username=${encodeURIComponent(updatedUserInfo.taiKhoan)}; path=/`;
                                document.cookie = `tuoi=${encodeURIComponent(updatedUserInfo.tuoi)}; path=/`;
                                document.cookie = `soDienThoai=${encodeURIComponent(updatedUserInfo.soDienThoai)}; path=/`;
                                document.cookie = `diaChi=${encodeURIComponent(updatedUserInfo.diaChi)}; path=/`;
                            } else {
                                alert("L·ªói: " + data.error);
                            }
                        })
                        .catch(error => {
                            console.error("L·ªói khi g·ª≠i y√™u c·∫ßu:", error);
                            alert("C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t. Vui l√≤ng th·ª≠ l·∫°i.");
                        });
                });
            });


            // ƒê·ª£i DOM load tr∆∞·ªõc khi ch·∫°y script
            document.addEventListener("DOMContentLoaded", function () {
                // H√†m l·∫•y gi√° tr·ªã t·ª´ cookie
                function getCookie(name) {
                    let cookies = document.cookie.split("; ");
                    for (let i = 0; i < cookies.length; i++) {
                        let parts = cookies[i].split("=");
                        if (parts[0] === name) {
                            return decodeURIComponent(parts[1]);
                        }
                    }
                    return ""; // Tr·∫£ v·ªÅ chu·ªói r·ªóng n·∫øu kh√¥ng t√¨m th·∫•y
                }

                // Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng khi m·ªü modal
                let chatButton = document.querySelector(".chat-btn");
                if (chatButton) {
                    chatButton.addEventListener("click", function () {
                        let hoTenEl = document.getElementById("popup-ho-ten");
                        let emailEl = document.getElementById("popup-email");
                        let usernameEl = document.getElementById("popup-username");
                        let tuoiEl = document.getElementById("popup-tuoi");
                        let soDienThoaiEl = document.getElementById("popup-so-dien-thoai");
                        let diaChiEl = document.getElementById("popup-dia-chi");

                        // Ki·ªÉm tra xem c√°c ph·∫ßn t·ª≠ c√≥ t·ªìn t·∫°i tr∆∞·ªõc khi g√°n gi√° tr·ªã
                        if (hoTenEl && emailEl && usernameEl && tuoiEl && soDienThoaiEl && diaChiEl) {
                            hoTenEl.innerText = getCookie("hoTen") || "Ch∆∞a ƒëƒÉng nh·∫≠p";
                            emailEl.innerText = getCookie("email") || "Ch∆∞a ƒëƒÉng nh·∫≠p";
                            usernameEl.innerText = getCookie("username") || "Ch∆∞a ƒëƒÉng nh·∫≠p";
                            tuoiEl.innerText = getCookie("tuoi") || "Ch∆∞a c√≥ d·ªØ li·ªáu";
                            soDienThoaiEl.innerText = getCookie("soDienThoai") || "Ch∆∞a c√≥ d·ªØ li·ªáu";
                            diaChiEl.innerText = getCookie("diaChi") || "Ch∆∞a c√≥ d·ªØ li·ªáu";
                        } else {
                            console.error("Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng.");
                        }
                    });
                } else {
                    console.error("Kh√¥ng t√¨m th·∫•y n√∫t m·ªü modal. Ki·ªÉm tra l·∫°i class.");
                }
            });

            document.addEventListener("DOMContentLoaded", function () {
                let logoutBtn = document.getElementById("logoutBtn");

                if (!logoutBtn) {
                    console.error("Kh√¥ng t√¨m th·∫•y n√∫t ƒëƒÉng xu·∫•t.");
                    return;
                }

                logoutBtn.addEventListener("click", function () {
                    if (!document.cookie.includes("username=")) {
                        alert("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p!");
                        return;
                    }

                    // H√†m x√≥a cookie
                    function deleteCookie(name) {
                        document.cookie = name + "=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
                        document.cookie = name + "=; path=/; domain=" + window.location.hostname + "; expires=Thu, 01 Jan 1970 00:00:00 UTC;";
                    }

                    // X√≥a danh s√°ch cookie li√™n quan ƒë·∫øn t√†i kho·∫£n
                    ["username", "hoTen", "email", "tuoi", "soDienThoai", "diaChi"].forEach(deleteCookie);

                    // Log ƒë·ªÉ ki·ªÉm tra
                    console.log("Cookies sau khi x√≥a:", document.cookie);

                    // C·∫≠p nh·∫≠t giao di·ªán (t·∫£i l·∫°i trang)
                    alert("B·∫°n ƒë√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!");
                    window.location.reload();
                });
            });



            document.addEventListener("DOMContentLoaded", function () {
                document.querySelector(".chat-btn").addEventListener("click", function (event) {
                    event.preventDefault(); // NgƒÉn t·∫£i l·∫°i trang
                    var myModal = new bootstrap.Modal(document.getElementById('userModal'));
                    myModal.show();
                });
            });
        </script>
    </main>
    <!-- Footer -->
    <footer class="footer" style="background-color:#873e23; height: 200px;">
    </footer>
</body>

</html>